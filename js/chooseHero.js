/**
 * Created by wj on 2017/4/22.
 */
var heroJson={"heroes":[
        {"type":"坦克",
            "id":11,
            "members":[
                {"id":101,"name":"程咬金", "imgUrl":"../../images/wzry_heroes/tanKe/chengYaojin.jpg"},
                {"id":102,"name":"项羽","imgUrl":"../../images/wzry_heroes/tanKe/xiangYu.jpg"},
                {"id":103,"name":"刘婵","imgUrl":"../../images/wzry_heroes/tanKe/liuChan.jpg"},
                {"id":104,"name":"刘邦","imgUrl":"../../images/wzry_heroes/tanKe/liuBang.jpg"},
                {"id":105,"name":"墨子","imgUrl":"../../images/wzry_heroes/tanKe/moZi.jpg"},
                {"id":106,"name":"庄周","imgUrl":"../../images/wzry_heroes/tanKe/zhuangZhou.jpg"},
                {"id":107,"name":"廉颇","imgUrl":"../../images/wzry_heroes/tanKe/lianPo.jpg"},
                {"id":108,"name":"张飞","imgUrl":"../../images/wzry_heroes/tanKe/zhangFei.jpg"},
                {"id":109,"name":"牛魔","imgUrl":"../../images/wzry_heroes/tanKe/niuMo.jpg"},
                {"id":110,"name":"白起","imgUrl":"../../images/wzry_heroes/tanKe/baiQi.jpg"}
            ]
        },
        {"type":"战士",
            "id":12,
            "members":[
                {"id":201,"name":"哪吒", "imgUrl":"../../images/wzry_heroes/zhanShi/neZha.jpg"},
                {"id":202,"name":"杨戬","imgUrl":"../../images/wzry_heroes/zhanShi/yangJian.jpg"},
                {"id":203,"name":"雅典娜","imgUrl":"../../images/wzry_heroes/zhanShi/yaDianna.jpg"},
                {"id":204,"name":"亚瑟","imgUrl":"../../images/wzry_heroes/zhanShi/yaSe.jpg"},
                {"id":205,"name":"花木兰","imgUrl":"../../images/wzry_heroes/zhanShi/huaMulan.jpg"},
                {"id":206,"name":"露娜","imgUrl":"../../images/wzry_heroes/zhanShi/luNa.jpg"},
                {"id":207,"name":"曹操","imgUrl":"../../images/wzry_heroes/zhanShi/caoCao.jpg"},
                {"id":208,"name":"孙悟空","imgUrl":"../../images/wzry_heroes/zhanShi/sunWukong.jpg"},
                {"id":209,"name":"吕布","imgUrl":"../../images/wzry_heroes/zhanShi/lvBu.jpg"},
                {"id":210,"name":"达摩","imgUrl":"../../images/wzry_heroes/zhanShi/daMo.jpg"},
                {"id":211,"name":"钟无艳","imgUrl":"../../images/wzry_heroes/zhanShi/zhongWuyan.jpg"},
                {"id":212,"name":"关羽","imgUrl":"../../images/wzry_heroes/zhanShi/guanYu.jpg"},
                {"id":213,"name":"赵云","imgUrl":"../../images/wzry_heroes/zhanShi/zhaoYun.jpg"},
                {"id":214,"name":"宫本武藏","imgUrl":"../../images/wzry_heroes/zhanShi/gongBenwuzang.jpg"},
                {"id":215,"name":"典韦","imgUrl":"../../images/wzry_heroes/zhanShi/dianWei.jpg"},
                {"id":216,"name":"老夫子","imgUrl":"../../images/wzry_heroes/zhanShi/laoFuzi.jpg"},
                {"id":217,"name":"夏侯淳","imgUrl":"../../images/wzry_heroes/zhanShi/xiaHouchun.jpg"},
                {"id":218,"name":"橘右京","imgUrl":"../../images/wzry_heroes/zhanShi/juYoujing.jpg"}
            ]
        },
        {"type":"刺客",
            "id":13,
            "members":[
                {"id":301,"name":"韩信", "imgUrl":"../../images/wzry_heroes/ciKe/hanXin.jpg"},
                {"id":302,"name":"荆轲", "imgUrl":"../../images/wzry_heroes/ciKe/jingKe.jpg"},
                {"id":303,"name":"李白", "imgUrl":"../../images/wzry_heroes/ciKe/liBai.jpg"},
                {"id":304,"name":"娜可露露", "imgUrl":"../../images/wzry_heroes/ciKe/naKelulu.jpg"},
                {"id":305,"name":"兰陵王", "imgUrl":"../../images/wzry_heroes/ciKe/lanLingwang.jpg"}
            ]
        },
        {"type":"法师",
            "id":14,
            "members":[
                {"id":401,"name":"诸葛亮", "imgUrl":"../../images/wzry_heroes/faShi/zhuGeliang.jpg"},
                {"id":402,"name":"小乔", "imgUrl":"../../images/wzry_heroes/faShi/xiaoQiao.jpg"},
                {"id":403,"name":"安琪拉", "imgUrl":"../../images/wzry_heroes/faShi/anQila.jpg"},
                {"id":404,"name":"扁鹊", "imgUrl":"../../images/wzry_heroes/faShi/bianQue.jpg"},
                {"id":405,"name":"不知火舞", "imgUrl":"../../images/wzry_heroes/faShi/buZhihuowu.jpg"},
                {"id":406,"name":"东皇太一", "imgUrl":"../../images/wzry_heroes/faShi/dongHuangtaiyi.jpg"},
                {"id":407,"name":"周瑜", "imgUrl":"../../images/wzry_heroes/faShi/zhouYu.jpg"},
                {"id":408,"name":"妲己", "imgUrl":"../../images/wzry_heroes/faShi/daJi.jpg"},
                {"id":409,"name":"姜子牙", "imgUrl":"../../images/wzry_heroes/faShi/jiangZiya.jpg"},
                {"id":410,"name":"嬴政", "imgUrl":"../../images/wzry_heroes/faShi/yingZheng.jpg"},
                {"id":411,"name":"张良", "imgUrl":"../../images/wzry_heroes/faShi/zhangLiang.jpg"},
                {"id":412,"name":"武则天", "imgUrl":"../../images/wzry_heroes/faShi/wuZetian.jpg"},
                {"id":413,"name":"王昭君", "imgUrl":"../../images/wzry_heroes/faShi/wangZhaojun.jpg"},
                {"id":414,"name":"甄姬", "imgUrl":"../../images/wzry_heroes/faShi/zhenJi.jpg"},
                {"id":415,"name":"芈月", "imgUrl":"../../images/wzry_heroes/faShi/miYue.jpg"},
                {"id":416,"name":"貂蝉", "imgUrl":"../../images/wzry_heroes/faShi/diaoChan.jpg"},
                {"id":417,"name":"钟馗", "imgUrl":"../../images/wzry_heroes/faShi/zhongKui.jpg"},
                {"id":418,"name":"高渐离", "imgUrl":"../../images/wzry_heroes/faShi/gaoJianli.jpg"}
            ]
        },
        {"type":"射手",
            "id":15,
            "members":[
                {"id":501,"name":"后羿", "imgUrl":"../../images/wzry_heroes/sheShou/houYi.jpg"},
                {"id":502,"name":"虞姬", "imgUrl":"../../images/wzry_heroes/sheShou/yuJi.jpg"},
                {"id":503,"name":"刘备", "imgUrl":"../../images/wzry_heroes/sheShou/liuBei.jpg"},
                {"id":504,"name":"孙尚香", "imgUrl":"../../images/wzry_heroes/sheShou/sunShangxiang.jpg"},
                {"id":505,"name":"成吉思汗", "imgUrl":"../../images/wzry_heroes/sheShou/chengJisihan.jpg"},
                {"id":506,"name":"李元芳", "imgUrl":"../../images/wzry_heroes/sheShou/liYuanfang.jpg"},
                {"id":507,"name":"狄仁杰", "imgUrl":"../../images/wzry_heroes/sheShou/diRenjie.jpg"},
                {"id":508,"name":"马可波罗", "imgUrl":"../../images/wzry_heroes/sheShou/maKeboluo.jpg"},
                {"id":509,"name":"鲁班七号", "imgUrl":"../../images/wzry_heroes/sheShou/luBanqihao.jpg"},
                {"id":510,"name":"黄忠", "imgUrl":"../../images/wzry_heroes/sheShou/huangZhong.jpg"}
            ]
        },
        {"type":"辅助",
            "id":16,
            "members":[
                {"id":601,"name":"大乔", "imgUrl":"../../images/wzry_heroes/fuZhu/daQiao.jpg"},
                {"id":602,"name":"蔡文姬", "imgUrl":"../../images/wzry_heroes/fuZhu/caiWenji.jpg"},
                {"id":603,"name":"太乙真人", "imgUrl":"../../images/wzry_heroes/fuZhu/taiYizhenren.jpg"},
                {"id":604,"name":"孙膑", "imgUrl":"../../images/wzry_heroes/fuZhu/sunBin.jpg"}
            ]
        }

    ]};


    
    function conMinH(){//左侧类型列表最小高度
        var winMiddleH = $(window).height() - $(".aui-bar-nav").outerHeight() - $(".c_btn").outerHeight();
        var rightH = $(".c_heroClassifyCon").outerHeight();
        if(winMiddleH>=rightH){
            $(".c_heroClassifyTab").css("min-height",winMiddleH);
        }else{
            $(".c_heroClassifyTab").css("min-height",rightH);
        }
    }
    var heroTypeHtml='';
    for(var i in heroJson.heroes){//初始生成左侧英雄类型列表
        heroTypeHtml+='<div id="type'+heroJson.heroes[i].id+'">'+heroJson.heroes[i].type+'</div>';
    }
    var heroBoxHtml='';
    for(var i in heroJson.heroes){//初始生成右侧所有英雄
        heroBoxHtml+='<ul id="heroList'+heroJson.heroes[i].id+'" class="c_heroBox clear-fix">';
        for(var j in heroJson.heroes[i].members){
            heroBoxHtml+='<li id="hero'+heroJson.heroes[i].members[j].id+'">';
            heroBoxHtml+='<img src="'+heroJson.heroes[i].members[j].imgUrl+'" alt="'+heroJson.heroes[i].members[j].name+'">';
            heroBoxHtml+='<span class="heroName">'+heroJson.heroes[i].members[j].name+'</span></li>';
        }
        heroBoxHtml+="</ul>";
    }
    //console.log(heroTypeHtml);
   // console.log(heroBoxHtml);
    $("#heroType").html(heroTypeHtml);
    $("#heroType div").first().addClass("on");
    $("#heroesBox").html(heroBoxHtml);
    $("#heroesBox ul").hide();
    $("#heroesBox ul").first().show();
    
    conMinH();//首次加载左侧高度自适应，必须内容生成后调用
    
    /* 点击英雄出现光圈 */
    $("#heroesBox").on("click","li",function(){
    	if(type==4){//熟练度页面处理逻辑特殊，只能选一个英雄
    		$(this).addClass("selected");
    		$("#heroesBox>.c_heroBox>li").not($(this)).removeClass("selected");;
    	}else{
    		$(this).toggleClass("selected");
    	}
    });

    $("#heroType").on("click","div",function(){//点击显示相应类型的英雄成员
        var typeId=$(this).attr("id").slice(4);
        $(this).addClass("on").siblings("div").removeClass("on");
        $("#heroList"+typeId).show().siblings("ul").hide();
        conMinH();
    });


    function GetQueryString(name) {//页面跳转回来保存type值
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r != null){
            return r[2];
        }
    }
    var type=GetQueryString("type");
    var value=GetQueryString("value");

    function saveHeroes(){//保存选中的英雄到sessionStorage
    	var selHeroes=$("#heroesBox li.selected");
        if(selHeroes.length==0){
            layer.msg("请至少选择一个英雄")
        }else{
            if(type==1){
                var selHeroesArr1=[];
                selHeroes.each(function () {
                    selHeroesArr1.push({"id":parseInt($(this).attr("id").slice(4)),"name":$(this).find("span").html(),"type":type})
                });
                sessionStorage.setItem("selHeroes1",JSON.stringify(selHeroesArr1));
                setTimeout(function(){
        			window.location.href = '/view/html/ranking.html?type='+type;
        		},500);
            }else if(type==2){
                var selHeroesArr2=[];
                selHeroes.each(function () {
                    selHeroesArr2.push({"id":parseInt($(this).attr("id").slice(4)),"name":$(this).find("span").html(),"type":type})
                });
                sessionStorage.setItem("selHeroes2",JSON.stringify(selHeroesArr2));
                setTimeout(function(){
        			window.location.href = '/view/html/achievement.html?type='+type;
        		},500);
            }else if(type==3){
                var selHeroesArr3=[];
                selHeroes.each(function () {
                    selHeroesArr3.push({"id":parseInt($(this).attr("id").slice(4)),"name":$(this).find("span").html(),"type":type})
                });
                sessionStorage.setItem("selHeroes3",JSON.stringify(selHeroesArr3));
                setTimeout(function(){
        			window.location.href = '/view/html/reward.html?type='+type;
        		},500);
            }else if(type==4){//熟练度储存指定英雄（特殊），只能选一个英雄
            	if(value==40){//熟练度
            		var selHeroes4v40;
            		selHeroes4v40={"id":parseInt(selHeroes.eq(0).attr("id").slice(4)),"name":selHeroes.eq(0).find("span").html(),"type":type};
            		sessionStorage.setItem("selHeroes4v40",JSON.stringify(selHeroes4v40));
            	}else if(value==45){//战力
            		var selHeroes4v45;
            		selHeroes4v45={"id":parseInt(selHeroes.eq(0).attr("id").slice(4)),"name":selHeroes.eq(0).find("span").html(),"type":type};
            		sessionStorage.setItem("selHeroes4v45",JSON.stringify(selHeroes4v45));
            	}
            	setTimeout(function(){
        			window.location.href = '/view/html/proficiency.html?type='+type;
        		},500);
            }else if(type==5){
                var selHeroesArr5=[];
                selHeroes.each(function () {
                    selHeroesArr5.push({"id":parseInt($(this).attr("id").slice(4)),"name":$(this).find("span").html(),"type":type})
                });
                sessionStorage.setItem("selHeroes5",JSON.stringify(selHeroesArr5));
                setTimeout(function(){
        			window.location.href = '/view/html/goldCoin.html?type='+type;
        		},500);
            }else if(type==6){
                var selHeroesArr6=[];
                selHeroes.each(function () {
                    selHeroesArr6.push({"id":parseInt($(this).attr("id").slice(4)),"name":$(this).find("span").html(),"type":type})
                });
                sessionStorage.setItem("selHeroes6",JSON.stringify(selHeroesArr6));
                setTimeout(function(){
        			window.location.href = '/view/html/more.html?type='+type;
        		},500);
            }
        }
    }
    
    var getHeroes=JSON.parse(sessionStorage.getItem("selHeroes"+type));
    if(type==4){
    	console.log(value)
    	if(value==40){
    		var selHeroes4v40=JSON.parse(sessionStorage.getItem(selHeroes4v40));
    		console.log(selHeroes4v40)
    		if(selHeroes4v40!=null){
    			$("#hero"+selHeroes4v40.id).addClass("selected");
    		}
    	}else if(value==45){
    		var selHeroes4v45=JSON.parse(sessionStorage.getItem(selHeroes4v45));
    		console.log(selHeroes4v45)
    		if(selHeroes4v45!=null){
    			$("#hero"+selHeroes4v45.id).addClass("selected");
    		}
    	}
    }else{
    	for(var i in getHeroes){//获得本地储存的已选英雄，增加选中光圈
    		if(getHeroes[i].type==type){
    			$("#hero"+getHeroes[i].id).addClass("selected");
    		}
    	}
    }